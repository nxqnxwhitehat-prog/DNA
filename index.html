<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ â€” Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙˆÙƒÙŠÙ„</title>
<style>
body {
  margin:0; font-family: Arial, sans-serif;
  background:#e8f6ff; direction: rtl; text-align: right;
  opacity:0; transition: opacity 1.5s ease;
}

/* ===== Ø´Ø§Ø´Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ ===== */
#splashScreen {
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: #f8f4ec;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  transition: opacity 1s ease;
}
#splashScreen img {
  max-width: 300px;
  width: 60%;
  height: auto;
}
.hiddenSplash {
  opacity: 0;
  pointer-events: none;
}

/* ===== ØªØµÙ…ÙŠÙ… Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ===== */
.navbar {
  position:fixed; top:0; right:0; width:100%;
  background:#007bff; display:flex; flex-direction:row-reverse;
  justify-content:flex-start; padding:10px;
  box-shadow:0 2px 5px rgba(0,0,0,0.2); z-index:1000;
}
.navbar button {
  background:#fff; color:#007bff; border:none;
  padding:10px 18px; margin-left:10px; border-radius:8px; cursor:pointer;
}
.navbar button.active {
  background:#003f7f; color:#fff; font-weight:bold;
  box-shadow:0 0 8px rgba(0,0,0,0.25);
}
.fixed-image {
  position:fixed; top:70px; left:10px; width:110px;
  border-radius:8px; z-index:999;
}
.content { padding:100px 20px; max-width:1000px; margin:0 auto; opacity:1; transition:opacity 1.5s ease; }
.section { display:none; }
.section.active { display:block; animation:fadeIn .3s ease; }
@keyframes fadeIn { from{opacity:0} to{opacity:1} }
.box {
  background:#fff; padding:18px; border-radius:10px;
  box-shadow:0 2px 8px rgba(0,0,0,0.08);
  max-width:600px; margin:auto;
}
input, select, button {
  width:100%; padding:10px; margin:10px 0;
  border-radius:8px; border:1px solid #ccc;
  font-size:15px; box-sizing:border-box;
}
.user-list {
  background:#fff; padding:12px; border-radius:8px;
  box-shadow:0 1px 5px rgba(0,0,0,0.05);
  max-width:700px; margin:auto;
}
table { width:100%; border-collapse:collapse; background:#fff; border-radius:8px; overflow:hidden; }
th, td { padding:10px; border-bottom:1px solid #eee; text-align:center; }
th { background:#007bff; color:#fff; }
.chat-box {
  max-width:600px; margin:auto; background:#fff; padding:12px;
  border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,0.08);
  display:flex; flex-direction:column; height:420px;
}
.messages {
  flex:1; overflow-y:auto; padding:10px;
  border:1px solid #eee; border-radius:8px;
  background:#fafafa; margin-bottom:10px;
}
.message { background:#dff1ff; padding:8px 10px; border-radius:8px; margin:6px 0; }
.message .meta { font-weight:bold; color:#034a7f; margin-bottom:4px; }
.small { font-size:13px; color:#666; }
.center { text-align:center; }
.hidden { display:none; }
.delete-btn, .mute-btn, .clear-btn {
  background:#ff5252; color:white; border:none;
  padding:5px 10px; border-radius:6px; cursor:pointer;
}
.mute-btn { background:#ff9800; }
.clear-btn { background:#007bff; margin-bottom:10px; }
</style>
</head>

<body>

<!-- Ø´Ø§Ø´Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨ -->
<div id="splashScreen">
  <img src="Democratic Negotiation Agency Emblem.png" alt="DNA Logo">
</div>

<div class="navbar">
  <button onclick="showSection('home')">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
  <button onclick="showSection('about')">Ø­ÙˆÙ„</button>
  <button onclick="showSection('dna')">Ø§Ù†Ø¶Ù…Ø§Ù…</button>
  <button onclick="showSection('users')" id="membersBtn">Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</button>
  <button onclick="showSection('chat')" id="chatBtn" class="hidden">Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©</button>
</div>

<img src="DNA.png" alt="logo" class="fixed-image" onerror="this.style.display='none'">

<div class="content">
  <div id="home" class="section active">
    <div class="box">
      <h2>Ù…Ø±Ø­Ø¨Ù‹Ø§</h2>
      <p class="small">Ù‡Ø°Ø§ Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ®Ø²Ù† Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ù…Ø­Ù„ÙŠÙ‹Ø§ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­ (localStorage) Ø­ØªÙ‰ Ù„Ø§ ØªÙØ­Ø°Ù Ø¹Ù†Ø¯ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„.</p>
      <p class="small">ÙŠÙ…ÙƒÙ† Ù„Ù„ÙˆÙƒÙŠÙ„ Ø­Ø°Ù Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ø£Ùˆ Ù…Ù†Ø¹Ù‡Ù… Ù…Ù† Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø£Ùˆ Ù…Ø³Ø­ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ù„Ù„Ø¬Ù…ÙŠØ¹.</p>
    </div>
  </div>

  <div id="about" class="section">
    <div class="box">
      <h2>Ø¹Ù† Ø§Ù„Ù†Ø¸Ø§Ù…</h2>
      <p class="small">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø¨Ø³ÙŠØ·: ÙˆÙƒÙŠÙ„ ÙˆØ§Ø­Ø¯ ÙÙ‚Ø· ÙŠØ³ØªØ·ÙŠØ¹ Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ (Ø§Ù„Ø­Ø°ÙØŒ Ø§Ù„Ù…Ù†Ø¹ Ù…Ù† Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©ØŒ Ù…Ø³Ø­ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„).</p>
    </div>
  </div>

  <div id="dna" class="section">
    <div id="rulesBox" class="box">
      <h3>ğŸ“œ Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ ÙˆØ§Ù„Ø´Ø±ÙˆØ·</h3>
      <ul>
        <li>Ø§Ù„Ø§Ø­ØªØ±Ø§Ù… ÙˆØ§Ø¬Ø¨.</li>
        <li>Ù„Ø§ ÙŠÙØ³Ù…Ø­ Ø¨Ø£ÙƒØ«Ø± Ù…Ù† ÙˆÙƒÙŠÙ„ ÙˆØ§Ø­Ø¯.</li>
        <li>ÙŠØ¬Ø¨ Ø¹Ø¯Ù… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø£Ø³Ù…Ø§Ø¡ Ù…Ø²ÙŠÙØ©.</li>
      </ul>
      <div class="center"><button onclick="agreeRules()">Ø£ÙˆØ§ÙÙ‚ ÙˆØ£ÙƒÙ…Ù„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„</button></div>
    </div>

    <form id="voteForm" class="box hidden">
      <h3>Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ³Ø¬ÙŠÙ„</h3>
      <label>Ø§Ù„Ø§Ø³Ù…:</label>
      <input type="text" id="name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„" required>
      <label>Ø§Ù„Ø¹Ù…Ø±:</label>
      <input type="number" id="age" placeholder="Ø§Ù„Ø¹Ù…Ø±" required min="1">
      <label>Ø§Ù„Ø¯ÙˆØ±:</label>
      <select id="role" required>
        <option value="">Ø§Ø®ØªØ±...</option>
        <option value="ÙˆÙƒÙŠÙ„">ÙˆÙƒÙŠÙ„</option>
        <option value="Ø¹Ø¶Ùˆ">Ø¹Ø¶Ùˆ</option>
      </select>
      <button type="submit">ØªØ³Ø¬ÙŠÙ„</button>
    </form>

    <div id="welcomeBox" class="box hidden">
      <h3 id="welcomeTitle"></h3>
      <p class="small">ØªÙ… Ø­ÙØ¸ Ø­Ø³Ø§Ø¨Ùƒ ÙˆÙ„Ù† ÙŠÙØ­Ø°Ù ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© ÙˆØµÙØ­Ø© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡.</p>
    </div>
  </div>

  <div id="users" class="section">
    <h2 class="center">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ†</h2>
    <div id="userList" class="user-list box"></div>
  </div>

  <div id="chat" class="section">
    <h2 class="center">Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</h2>
    <div class="chat-box">
      <div id="agentTools" class="hidden center">
        <button class="clear-btn" onclick="clearChat()">ğŸ§¹ Ù…Ø³Ø­ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ù„Ù„Ø¬Ù…ÙŠØ¹</button>
      </div>
      <div id="messages" class="messages"></div>
      <input id="chatInput" type="text" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ø«Ù… Ø§Ø¶ØºØ· Enter" onkeydown="if(event.key==='Enter') sendMessage()">
      <button onclick="sendMessage()">Ø¥Ø±Ø³Ø§Ù„</button>
    </div>
  </div>
</div>

<script>
const USERS_KEY = 'users';
const CURRENT_KEY = 'currentUser';
const MESSAGES_KEY = 'messages';
let users = JSON.parse(localStorage.getItem(USERS_KEY)) || [];
let currentUser = JSON.parse(localStorage.getItem(CURRENT_KEY)) || null;
let messages = JSON.parse(localStorage.getItem(MESSAGES_KEY)) || [];

document.addEventListener('DOMContentLoaded', () => {
  updateChatButton();
  if (currentUser) showWelcome(currentUser);
  // Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©ØŒ Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ±Ø­ÙŠØ¨
  window.addEventListener('load', () => {
    const splash = document.getElementById('splashScreen');
    setTimeout(() => {
      splash.classList.add('hiddenSplash');
      document.body.style.opacity = 1;
      setTimeout(() => splash.remove(), 1000);
    }, 2000);
  });
});

function showSection(id) {
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  const el = document.getElementById(id);
  if (el) el.classList.add('active');
  document.querySelectorAll('.navbar button').forEach(b => b.classList.remove('active'));
  const match = Array.from(document.querySelectorAll('.navbar button')).find(b => b.getAttribute('onclick')?.includes(`'${id}'`));
  if (match) match.classList.add('active');
  if (id === 'users') renderUsers();
  if (id === 'chat') renderChat();
}

function agreeRules() {
  document.getElementById('rulesBox').classList.add('hidden');
  document.getElementById('voteForm').classList.remove('hidden');
}

document.getElementById('voteForm').addEventListener('submit', function(e){
  e.preventDefault();
  const name = document.getElementById('name').value.trim();
  const age = document.getElementById('age').value.trim();
  const role = document.getElementById('role').value;
  if (!name || !age || !role) return alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„.');
  if (role === 'ÙˆÙƒÙŠÙ„' && users.some(u => u.role === 'ÙˆÙƒÙŠÙ„')) return alert('âš ï¸ Ù‡Ù†Ø§Ùƒ ÙˆÙƒÙŠÙ„ Ø¨Ø§Ù„ÙØ¹Ù„.');
  if (users.some(u => u.name === name)) return alert('Ù‡Ø°Ø§ Ø§Ù„Ø§Ø³Ù… Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ù‹Ø§.');
  const newUser = { name, age, role, muted:false, createdAt: new Date().toISOString() };
  users.push(newUser);
  localStorage.setItem(USERS_KEY, JSON.stringify(users));
  currentUser = newUser;
  localStorage.setItem(CURRENT_KEY, JSON.stringify(currentUser));
  showWelcome(newUser);
  updateChatButton();
  alert('âœ… ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­.');
  this.reset();
});

function showWelcome(user) {
  document.getElementById('voteForm').classList.add('hidden');
  document.getElementById('rulesBox').classList.add('hidden');
  const w = document.getElementById('welcomeBox');
  w.classList.remove('hidden');
  document.getElementById('welcomeTitle').innerText = `Ù…Ø±Ø­Ø¨Ù‹Ø§ ${user.name} â€” Ø£Ù†Øª ${user.role}`;
}

function updateChatButton(){
  const btn = document.getElementById('chatBtn');
  if (currentUser) btn.classList.remove('hidden'); else btn.classList.add('hidden');
}

function renderUsers(){
  const el = document.getElementById('userList');
  if (users.length === 0) return el.innerHTML = '<p class="center small">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø¹Ø¶Ø§Ø¡.</p>';
  let html = `<table><thead><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ø¹Ù…Ø±</th><th>Ø§Ù„Ø¯ÙˆØ±</th><th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead><tbody>`;
  users.forEach((u,i) => {
    html += `<tr>
      <td>${escapeHtml(u.name)}</td>
      <td>${escapeHtml(u.age)}</td>
      <td>${escapeHtml(u.role)}</td>
      <td class="small">${new Date(u.createdAt).toLocaleString()}</td>
      <td>
        ${currentUser && currentUser.role === 'ÙˆÙƒÙŠÙ„' && u.name !== currentUser.name ? `
          <button class="mute-btn" onclick="toggleMute(${i})">${u.muted ? 'Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ù…Ù†Ø¹' : 'Ù…Ù†Ø¹ Ù…Ù† Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©'}</button>
          <button class="delete-btn" onclick="deleteUser(${i})">Ø­Ø°Ù</button>` : '-'}
      </td>
    </tr>`;
  });
  html += `</tbody></table>`;
  el.innerHTML = html;
}

function toggleMute(index){
  users[index].muted = !users[index].muted;
  localStorage.setItem(USERS_KEY, JSON.stringify(users));
  renderUsers();
  alert(users[index].muted ? 'ğŸš« ØªÙ… Ù…Ù†Ø¹ Ø§Ù„Ø¹Ø¶Ùˆ Ù…Ù† Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©' : 'âœ… ØªÙ… Ø§Ù„Ø³Ù…Ø§Ø­ Ù„Ù‡ Ù…Ø¬Ø¯Ø¯Ù‹Ø§');
}

function deleteUser(index){
  if (!currentUser || currentUser.role !== 'ÙˆÙƒÙŠÙ„') return alert('âŒ ÙÙ‚Ø· Ø§Ù„ÙˆÙƒÙŠÙ„ ÙŠÙ…ÙƒÙ†Ù‡ Ø­Ø°Ù Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡.');
  if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø¶ÙˆØŸ')) return;
  const removed = users.splice(index,1)[0];
  localStorage.setItem(USERS_KEY, JSON.stringify(users));
  renderUsers();
  alert('ğŸ—‘ï¸ ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¹Ø¶Ùˆ.');
}

function renderChat(){
  const tools = document.getElementById('agentTools');
  if (currentUser && currentUser.role === 'ÙˆÙƒÙŠÙ„') tools.classList.remove('hidden');
  else tools.classList.add('hidden');
  renderMessages();
}

function clearChat(){
  if (!currentUser || currentUser.role !== 'ÙˆÙƒÙŠÙ„') return alert('âŒ ÙÙ‚Ø· Ø§Ù„ÙˆÙƒÙŠÙ„ ÙŠÙ…ÙƒÙ†Ù‡ Ù…Ø³Ø­ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©.');
  if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ØŸ')) return;
  messages = [];
  localStorage.setItem(MESSAGES_KEY, JSON.stringify(messages));
  renderMessages();
  alert('ğŸ§¹ ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø¨Ù†Ø¬Ø§Ø­.');
}

function sendMessage(){
  const input = document.getElementById('chatInput');
  const text = input.value.trim();
  if (!text || !currentUser) return;
  if (currentUser.muted) return alert('ğŸš« ØªÙ… Ù…Ù†Ø¹Ùƒ Ù…Ù† Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„.');
  const msg = { user: currentUser.name, role: currentUser.role, text, time: new Date().toISOString() };
  messages.push(msg);
  localStorage.setItem(MESSAGES_KEY, JSON.stringify(messages));
  input.value = '';
  renderMessages();
}

function renderMessages(){
  const box = document.getElementById('messages');
  if (messages.length === 0) return box.innerHTML = '<p class="small center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„ Ø¨Ø¹Ø¯.</p>';
  box.innerHTML = messages.map(m=>{
    const mark = m.role === 'ÙˆÙƒÙŠÙ„' ? ' (ÙˆÙƒÙŠÙ„)' : '';
    return `<div class="message"><div class="meta">${escapeHtml(m.user)}${mark} <span class="small">â€” ${new Date(m.time).toLocaleString()}</span></div><div>${escapeHtml(m.text)}</div></div>`;
  }).join('');
  box.scrollTop = box.scrollHeight;
}

function escapeHtml(str){ return str?.replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m]))||''; }
</script>

</body>
</html>
