<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ â€” Ù…Ø­ÙÙˆØ¸ Ù…Ø­Ù„ÙŠÙ‹Ø§</title>
  <style>
    body { margin:0; font-family: Arial, sans-serif; background:#e8f6ff; direction: rtl; text-align: right; }
    .navbar { position:fixed; top:0; right:0; width:100%; background:#007bff; display:flex; flex-direction:row-reverse; justify-content:flex-start; padding:10px; box-shadow:0 2px 5px rgba(0,0,0,0.2); z-index:1000;}
    .navbar button { background:#fff; color:#007bff; border:none; padding:10px 18px; margin-left:10px; border-radius:8px; cursor:pointer; }
    .navbar button.active { background:#003f7f; color:#fff; font-weight:bold; box-shadow:0 0 8px rgba(0,0,0,0.25); }
    .fixed-image { position:fixed; top:70px; left:10px; width:110px; border-radius:8px; z-index:999; }
    .content { padding:100px 20px; max-width:1000px; margin:0 auto; }
    .section { display:none; }
    .section.active { display:block; animation:fadeIn .3s ease; }
    @keyframes fadeIn { from{opacity:0} to{opacity:1} }
    .box { background:#fff; padding:18px; border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,0.08); max-width:600px; margin:auto; }
    input, select, button { width:100%; padding:10px; margin:10px 0; border-radius:8px; border:1px solid #ccc; font-size:15px; box-sizing:border-box; }
    .user-list { background:#fff; padding:12px; border-radius:8px; box-shadow:0 1px 5px rgba(0,0,0,0.05); max-width:700px; margin:auto; }
    table { width:100%; border-collapse:collapse; background:#fff; border-radius:8px; overflow:hidden; }
    th, td { padding:10px; border-bottom:1px solid #eee; text-align:center; }
    th { background:#007bff; color:#fff; }
    .chat-box { max-width:600px; margin:auto; background:#fff; padding:12px; border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,0.08); display:flex; flex-direction:column; height:420px; }
    .messages { flex:1; overflow-y:auto; padding:10px; border:1px solid #eee; border-radius:8px; background:#fafafa; margin-bottom:10px; }
    .message { background:#dff1ff; padding:8px 10px; border-radius:8px; margin:6px 0; }
    .message .meta { font-weight:bold; color:#034a7f; margin-bottom:4px; }
    .small { font-size:13px; color:#666; }
    .center { text-align:center; }
  </style>
</head>
<body>

  <div class="navbar">
    <button onclick="showSection('home')">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
    <button onclick="showSection('about')">Ø­ÙˆÙ„</button>
    <button onclick="showSection('dna')">Ø§Ù†Ø¶Ù…Ø§Ù…</button>
    <button onclick="showSection('users')" id="membersBtn">Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</button>
    <button onclick="showSection('chat')" id="chatBtn" class="hidden">Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©</button>
  </div>

  <!-- Ø§Ø®ØªÙŠØ§Ø±ÙŠ: Ù„Ùˆ Ø¹Ù†Ø¯Ùƒ ØµÙˆØ±Ø© Ø¶Ø¹ Ø§Ø³Ù…Ù‡Ø§ Ù‡Ù†Ø§ -->
  <img src="DNA.png" alt="logo" class="fixed-image" onerror="this.style.display='none'">

  <div class="content">
    <div id="home" class="section active">
      <div class="box">
        <h2>Ù…Ø±Ø­Ø¨Ù‹Ø§</h2>
        <p class="small">Ù‡Ø°Ø§ Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ®Ø²Ù† Ø­Ø³Ø§Ø¨Ø§Øª Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ù…Ø­Ù„ÙŠÙ‹Ø§ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­ (localStorage) Ø­ØªÙ‰ Ù„Ø§ ØªÙØ­Ø°Ù Ø¹Ù†Ø¯ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„. Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¢Ù„ÙŠØ© Ø­Ø°Ù Ø¹Ø¨Ø± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© â€” Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¨Ù‚Ù‰ Ù…Ø­ÙÙˆØ¸Ø© Ø­ØªÙ‰ ØªÙ…Ø³Ø­Ù‡Ø§ Ù…Ù† Ø§Ù„Ù…ØªØµÙØ­.</p>
        <p class="small">Ù…Ù„Ø§Ø­Ø¸Ø©: Ø¥Ø°Ø§ Ø£Ø±Ø¯Øª Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª ÙŠØ¯ÙˆÙŠØ§Ù‹ ÙŠÙ…ÙƒÙ†Ùƒ ÙØªØ­ Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ø·ÙˆØ± ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­ â†’ Application â†’ Local Storage â†’ ÙˆØ­Ø°Ù Ø§Ù„Ù…ÙØªØ§Ø­ "users" Ø£Ùˆ "currentUser".</p>
      </div>
    </div>

    <div id="about" class="section">
      <div class="box">
        <h2>Ø¹Ù† Ø§Ù„Ù†Ø¸Ø§Ù…</h2>
        <p class="small">Ù†Ø¸Ø§Ù… ØªØ³Ø¬ÙŠÙ„ Ø¨Ø³ÙŠØ·: ÙƒÙ„ Ø¹Ø¶Ùˆ ÙŠÙ…Ù„Ø£ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø¹Ù…Ø± ÙˆÙŠØ®ØªØ§Ø± Ø¯ÙˆØ±Ù‡ (Ø¹Ø¶Ùˆ Ø£Ùˆ ÙˆÙƒÙŠÙ„). ÙÙ‚Ø· ÙˆÙƒÙŠÙ„ ÙˆØ§Ø­Ø¯ Ù…Ø³Ù…ÙˆØ­. Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ù…Ø­ÙÙˆØ¸Ø© Ù…Ø­Ù„ÙŠÙ‹Ø§ ÙˆÙ„Ø§ ØªØ­Ø°Ù ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§.</p>
      </div>
    </div>

    <div id="dna" class="section">
      <div id="rulesBox" class="box">
        <h3>ğŸ“œ Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ ÙˆØ§Ù„Ø´Ø±ÙˆØ·</h3>
        <ul>
          <li>Ø§Ù„Ø§Ø­ØªØ±Ø§Ù… ÙˆØ§Ø¬Ø¨.</li>
          <li>Ù„Ø§ ÙŠÙØ³Ù…Ø­ Ø¨Ø£ÙƒØ«Ø± Ù…Ù† ÙˆÙƒÙŠÙ„ ÙˆØ§Ø­Ø¯.</li>
          <li>ÙŠØ¬Ø¨ Ø¹Ø¯Ù… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø£Ø³Ù…Ø§Ø¡ Ù…Ø²ÙŠÙØ©.</li>
        </ul>
        <div class="center"><button onclick="agreeRules()">Ø£ÙˆØ§ÙÙ‚ ÙˆØ£ÙƒÙ…Ù„ Ø§Ù„ØªØ³Ø¬ÙŠÙ„</button></div>
      </div>

      <form id="voteForm" class="box hidden">
        <h3>Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ³Ø¬ÙŠÙ„</h3>
        <label>Ø§Ù„Ø§Ø³Ù…:</label>
        <input type="text" id="name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„" required>

        <label>Ø§Ù„Ø¹Ù…Ø±:</label>
        <input type="number" id="age" placeholder="Ø§Ù„Ø¹Ù…Ø±" required min="1">

        <label>Ø§Ù„Ø¯ÙˆØ±:</label>
        <select id="role" required>
          <option value="">Ø§Ø®ØªØ±...</option>
          <option value="ÙˆÙƒÙŠÙ„">ÙˆÙƒÙŠÙ„</option>
          <option value="Ø¹Ø¶Ùˆ">Ø¹Ø¶Ùˆ</option>
        </select>

        <button type="submit">ØªØ³Ø¬ÙŠÙ„</button>
      </form>

      <div id="welcomeBox" class="box hidden">
        <h3 id="welcomeTitle"></h3>
        <p class="small">Ù„Ù‚Ø¯ ØªÙ… Ø­ÙØ¸ Ø­Ø³Ø§Ø¨Ùƒ Ù…Ø­Ù„ÙŠÙ‹Ø§ ÙˆÙ„Ù† ÙŠÙØ­Ø°Ù ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© ÙˆØ§Ù„ØµÙØ­Ø§Øª Ø§Ù„Ù…Ø®ØµØµØ© Ù„Ù„Ø£Ø¹Ø¶Ø§Ø¡.</p>
      </div>
    </div>

    <div id="users" class="section">
      <h2 class="center">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ø§Ù„Ù…Ø³Ø¬Ù„ÙŠÙ†</h2>
      <div id="userList" class="user-list box"></div>
    </div>

    <div id="chat" class="section">
      <h2 class="center">Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡</h2>
      <div class="chat-box">
        <div id="messages" class="messages"></div>
        <input id="chatInput" type="text" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„ØªÙƒ Ø«Ù… Ø§Ø¶ØºØ· Enter" onkeydown="if(event.key==='Enter') sendMessage()">
        <button onclick="sendMessage()">Ø¥Ø±Ø³Ø§Ù„</button>
      </div>
    </div>

  </div>

<script>
  // Ù…ÙØ§ØªÙŠØ­ Ø§Ù„ØªØ®Ø²ÙŠÙ†
  const USERS_KEY = 'users';
  const CURRENT_KEY = 'currentUser';
  const MESSAGES_KEY = 'messages';

  // Ø­Ø§Ù„Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù…Ø­Ù„ÙŠÙ‹Ø§
  let users = JSON.parse(localStorage.getItem(USERS_KEY)) || [];
  let currentUser = JSON.parse(localStorage.getItem(CURRENT_KEY)) || null;
  let messages = JSON.parse(localStorage.getItem(MESSAGES_KEY)) || [];

  // Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©: Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¹Ø±Ø¶ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ ÙˆØ¬ÙˆØ¯ Ù…Ø³ØªØ®Ø¯Ù…
  document.addEventListener('DOMContentLoaded', () => {
    // Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© ÙÙ‚Ø· Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¬Ù‘Ù„ (currentUser)
    updateChatButton();
    // Ø¹Ù†Ø¯ ÙˆØ¬ÙˆØ¯ Ù…Ø³ØªØ®Ø¯Ù… Ø­Ø§Ù„Ù Ø£Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨ÙŠØ©
    if (currentUser) showWelcome(currentUser);
    updateMembersButton();
  });

  // Ø§Ù„ØªÙ†Ù‚Ù‘Ù„ Ø¨ÙŠÙ† Ø§Ù„Ø£Ù‚Ø³Ø§Ù…
  function showSection(id) {
    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
    const el = document.getElementById(id);
    if (el) el.classList.add('active');

    // ØªØ¹ÙŠÙŠÙ† ØªÙ…ÙŠÙŠØ² Ø§Ù„Ø²Ø±
    document.querySelectorAll('.navbar button').forEach(b => b.classList.remove('active'));
    // Ø§Ø³ØªØ®Ø¯Ø§Ù… event.target Ù‚Ø¯ Ù„Ø§ ÙŠØ¹Ù…Ù„ Ø¹Ù†Ø¯ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø¨Ø±Ù…Ø¬ÙŠÙ‹Ø§ØŒ ÙÙ„Ù†Ø¬Ø¹Ù„ Ø§Ù„ØªÙ…ÙŠÙŠØ² ÙŠØ¯ÙˆÙŠÙ‹Ø§:
    const btns = Array.from(document.querySelectorAll('.navbar button'));
    const match = btns.find(b => b.getAttribute('onclick') && b.getAttribute('onclick').includes(`'${id}'`));
    if (match) match.classList.add('active');

    // Ø¥Ø°Ø§ Ø¯Ø®Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¹Ù„Ù‰ ØµÙØ­Ø© Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ø£Ùˆ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø­Ø¯Ù‘Ø« Ø§Ù„Ø¹Ø±Ø¶
    if (id === 'users') renderUsers();
    if (id === 'chat') renderMessages();
  }

  // Ø§Ù„Ù‚ÙˆØ§Ø¹Ø¯ â†’ Ø¥Ø¸Ù‡Ø§Ø± Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ø¹Ø¯ Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø©
  function agreeRules() {
    document.getElementById('rulesBox').classList.add('hidden');
    document.getElementById('voteForm').classList.remove('hidden');
  }

  // Ø¥Ø±Ø³Ø§Ù„ Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
  document.getElementById('voteForm').addEventListener('submit', function(e){
    e.preventDefault();
    const name = document.getElementById('name').value.trim();
    const age = document.getElementById('age').value.trim();
    const role = document.getElementById('role').value;

    if (!name || !age || !role) {
      alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„.');
      return;
    }

    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ ÙˆÙƒÙŠÙ„ Ù…Ù† Ù‚Ø¨Ù„ (Ù…Ø³ØªÙ…Ø± Ø¹Ø¨Ø± Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ù„Ø£Ù†Ù†Ø§ Ù†Ø­Ù…Ù„ users Ù…Ù† localStorage)
    if (role === 'ÙˆÙƒÙŠÙ„' && users.some(u => u.role === 'ÙˆÙƒÙŠÙ„')) {
      alert('âš ï¸ Ø¨Ø§Ù„ÙØ¹Ù„ Ù‡Ù†Ø§Ùƒ ÙˆÙƒÙŠÙ„ ÙˆØ§Ø­Ø¯ Ù…Ø³Ø¬Ù„. Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø¥Ø¶Ø§ÙØ© ÙˆÙƒÙŠÙ„ Ø¢Ø®Ø±.');
      return;
    }

    // Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø± Ø¨Ù†ÙØ³ Ø§Ù„Ø§Ø³Ù… (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
    if (users.some(u => u.name === name && u.age === age && u.role === role)) {
      alert('Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ù‹Ø§.');
      // ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ø®ØªÙŠØ§Ø± Ø£Ù„Ø§ ØªÙØ¹Ù„ Ø´ÙŠØ¦Ù‹Ø§ Ø£Ùˆ ØªØ³Ø¬ÙŠÙ„ ØªÙƒØ±Ø§Ø±Ø› Ù‡Ù†Ø§ Ù†Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø±.
      return;
    }

    // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø­Ø³Ø§Ø¨ ÙˆØ­ÙØ¸Ù‡
    const newUser = { name, age, role, createdAt: new Date().toISOString() };
    users.push(newUser);
    localStorage.setItem(USERS_KEY, JSON.stringify(users));

    // ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ ÙˆØ­ÙØ¸Ù‡ (ÙŠØ¶Ù…Ù† Ø¨Ù‚Ø§Ø¡Ù‡ "Ù…Ø³Ø¬Ù„Ø§Ù‹")
    currentUser = newUser;
    localStorage.setItem(CURRENT_KEY, JSON.stringify(currentUser));

    // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø¨Ø¹Ø¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„
    showWelcome(newUser);
    updateChatButton();
    updateMembersButton();
    alert('âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø­Ø³Ø§Ø¨ ÙˆØ­ÙØ¸Ù‡ Ù…Ø­Ù„ÙŠÙ‹Ø§.');
    // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„
    this.reset();
  });

  // Ø¥Ø¸Ù‡Ø§Ø± ØªØ±Ø­ÙŠØ¨ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø£Ùˆ Ø¥Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„ Ù…Ø³Ø¬Ù‘Ù„
  function showWelcome(user) {
    document.getElementById('voteForm').classList.add('hidden');
    document.getElementById('rulesBox').classList.add('hidden');
    const w = document.getElementById('welcomeBox');
    w.classList.remove('hidden');
    document.getElementById('welcomeTitle').innerText = `Ù…Ø±Ø­Ø¨Ù‹Ø§ ${user.name} â€” Ø£Ù†Øª Ù…Ø³Ø¬Ù„ ÙƒÙ€ ${user.role}`;
  }

  // Ø²Ø± Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ù…Ø±Ø¦ÙŠ ÙÙ‚Ø· Ø¹Ù†Ø¯ ÙˆØ¬ÙˆØ¯ currentUser
  function updateChatButton(){
    const btn = document.getElementById('chatBtn');
    if (currentUser) btn.classList.remove('hidden'); else btn.classList.add('hidden');
  }

  function updateMembersButton(){
    const btn = document.getElementById('membersBtn');
    if (users.length > 0) btn.disabled = false; else btn.disabled = false; // Ù…Ø§ Ø²Ù„Ù†Ø§ Ù†ØªØ±ÙƒÙ‡ Ù…ØªØ§Ø­Ù‹Ø§ Ø¯Ø§Ø¦Ù…Ø§Ù‹
  }

  // Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø¹Ø¶Ø§Ø¡ Ù…Ù† localStorage
  function renderUsers(){
    const el = document.getElementById('userList');
    if (users.length === 0) {
      el.innerHTML = '<p class="center small">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø¹Ø¶Ø§Ø¡ Ù…Ø³Ø¬Ù„ÙŠÙ† Ø¨Ø¹Ø¯.</p>';
      return;
    }
    // Ø¬Ø¯ÙˆÙ„ Ù…Ø±ØªØ¨
    let html = `<table><thead><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ø¹Ù…Ø±</th><th>Ø§Ù„Ø¯ÙˆØ±</th><th>Ù…Ø³Ø¬Ù„ Ù…Ù†Ø°</th></tr></thead><tbody>`;
    users.forEach(u => {
      html += `<tr><td>${escapeHtml(u.name)}</td><td>${escapeHtml(u.age)}</td><td>${escapeHtml(u.role)}</td><td class="small">${new Date(u.createdAt).toLocaleString()}</td></tr>`;
    });
    html += `</tbody></table>`;
    el.innerHTML = html;
  }

  // --- Ø¯Ø±Ø¯Ø´Ø© Ù…Ø­Ù„ÙŠØ© Ù…Ø­ÙÙˆØ¸Ø© ---
  function sendMessage(){
    const input = document.getElementById('chatInput');
    const text = input.value.trim();
    if (!text) return;
    if (!currentUser) { alert('ÙŠØ¬Ø¨ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø£ÙˆÙ„Ø§Ù‹ Ù„Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø¯Ø±Ø¯Ø´Ø©.'); return; }

    const msg = { user: currentUser.name, role: currentUser.role, text, time: new Date().toISOString() };
    messages.push(msg);
    localStorage.setItem(MESSAGES_KEY, JSON.stringify(messages));
    input.value = '';
    renderMessages();
  }

  function renderMessages(){
    const box = document.getElementById('messages');
    if (!messages || messages.length === 0) { box.innerHTML = '<p class="small center">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„ Ø¨Ø¹Ø¯.</p>'; return; }
    box.innerHTML = messages.map(m => {
      // ÙŠÙ…ÙŠØ² Ø§Ø³Ù… Ø§Ù„ÙˆÙƒÙŠÙ„ Ø¨Ù„ÙˆÙ† (ÙˆÙŠÙ…ÙƒÙ† ØªØºÙŠÙŠØ±Ù‡ Ø¹Ø¨Ø± CSS Ù„Ø§Ø­Ù‚Ù‹Ø§)
      const roleMark = m.role === 'ÙˆÙƒÙŠÙ„' ? ' (ÙˆÙƒÙŠÙ„)' : '';
      return `<div class="message"><div class="meta">${escapeHtml(m.user)}${roleMark} <span class="small">â€” ${new Date(m.time).toLocaleString()}</span></div><div>${escapeHtml(m.text)}</div></div>`;
    }).join('');
    box.scrollTop = box.scrollHeight;
  }

  // Ø¯Ø§Ù„Ø© ØµØºÙŠØ±Ø© Ù„ØªØ¹Ù‚ÙŠÙ… Ù†Øµ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø¯Ø±Ø§Ø¬ ÙÙŠ HTML
  function escapeHtml(str){
    if (!str) return '';
    return str.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#039;');
  }

  // Ø§Ø®ØªÙŠØ§Ø±ÙŠ: Ø¯Ø§Ù„Ø© Ù„Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ù„Ù† Ù†ÙˆÙØ±Ù‡Ø§ ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø­Ø³Ø¨ Ø·Ù„Ø¨Ùƒ "Ù„Ø§ Ø­Ø°Ù")
  // Ù„ÙƒÙ† Ø¥Ù† Ø§Ø­ØªØ¬Øª Ù„Ù…Ø³Ø­ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø®Ù„Ø§Ù„ Ø§Ù„ØªØ·ÙˆÙŠØ±:
  // function clearAllLocalData(){ localStorage.removeItem(USERS_KEY); localStorage.removeItem(CURRENT_KEY); localStorage.removeItem(MESSAGES_KEY); location.reload(); }

  // Ù„Ø§Ø­Ù‚Ù‹Ø§: Ø¥Ø°Ø§ Ø£Ø±Ø¯Øª ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ Ø¯ÙˆÙ† Ø­Ø°Ù Ø§Ù„Ø­Ø³Ø§Ø¨ØŒ ÙŠÙ…ÙƒÙ†Ùƒ ÙØ¹Ù„:
  // function logout() { currentUser = null; localStorage.removeItem(CURRENT_KEY); updateChatButton(); }

</script>
</body>
</html>
